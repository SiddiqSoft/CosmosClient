<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CosmosClient: CosmosClient : Azure Cosmos REST-API Client for Modern C++</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Siddiq-Software-Avatar.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CosmosClient<span id="projectnumber">&#160;0.6.0-alpha.60</span>
   </div>
   <div id="projectbrief">Azure Cosmos REST Client for Modern C++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">CosmosClient : Azure Cosmos REST-API Client for Modern C++ </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md0">Features</a></li>
<li class="level1"><a href="#autotoc_md1">API</a></li>
<li class="level1"><a href="#autotoc_md2">Getting Started</a><ul><li class="level2"><a href="#autotoc_md3">Configuration</a></li>
<li class="level2"><a href="#autotoc_md4">Sample</a></li>
<li class="level2"><a href="#autotoc_md5">Testing Notes</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><dl class="section copyright"><dt>Copyright</dt><dd>&copy;2021 Siddiq Software LLC. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>siddiqsoft</dd></dl>
<p><a href="https://github.com/SiddiqSoft/CosmosClient/actions/workflows/codeql-analysis.yml"><img src="https://github.com/SiddiqSoft/CosmosClient/actions/workflows/codeql-analysis.yml/badge.svg" alt="CodeQL" style="pointer-events: none;" class="inline"/></a> <a href="https://dev.azure.com/siddiqsoft/siddiqsoft/_build/latest?definitionid=15&amp;branchName=main"><img src="https://dev.azure.com/siddiqsoft/siddiqsoft/_apis/build/status/SiddiqSoft.CosmosClient?branchName=main" alt="Build Status" class="inline"/></a> <img src="https://img.shields.io/github/v/tag/SiddiqSoft/CosmosClient" alt="" class="inline"/> <img src="https://img.shields.io/nuget/v/SiddiqSoft.CosmosClient" alt="" class="inline"/> <img src="https://img.shields.io/nuget/dt/SiddiqSoft.CosmosClient" alt="" class="inline"/> <img src="https://img.shields.io/azure-devops/tests/siddiqsoft/siddiqsoft/15" alt="" class="inline"/></p>
<p ><img src="https://img.shields.io/github/license/siddiqsoft/CosmosClient" alt="" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md0"></a>
Features</h1>
<ul>
<li>C++20 Azure Cosmos REST API client.<ul>
<li>Be instructive <em>and</em> functional.</li>
<li>Low-overhead&ndash;just not optimized.</li>
<li>C++20 sugarcoating</li>
</ul>
</li>
<li>JSON everywhere; configuration, I/O, results.</li>
<li>Implement the Cosmos SQL REST API<ul>
<li>All of the responses are JSON documents as returned from Azure Cosmos. We do not abstract/encapsulate unless there is value.</li>
<li>Implement Azure REST API best practices.</li>
</ul>
</li>
<li>Single header</li>
<li>Use Microsoft Win32 API for IO, encryption<ul>
<li>Dependency on <a href="https://github.com/nlohmann/json">nlohmann.json</a><ul>
<li>The best interface</li>
</ul>
</li>
<li>Dependency on <a href="https://github.com/siddiqsoft/azure-cpp-utils">azure-cpp-utils</a> our own library.<ul>
<li>We do not implement any encryption functions. We only add a thin modern C++ coating on the underlying Win32 SDK.</li>
</ul>
</li>
<li>Dependency on <a href="https://github.com/siddiqsoft/restcl">restcl</a> our own library.<ul>
<li>Again, we wrap a modern C++ sugar coat on the Win32 WinHTTP library. Nothing overly heavy or force you to use std::wstring or invent yet-another-string!</li>
</ul>
</li>
</ul>
</li>
<li>Simplicity and ease of use&ndash;focus on your problem set and let the libraries evolve.<ul>
<li>To this end, we do not worry about configuration/options</li>
<li>Use NuGet and focus on your application.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md1"></a>
API</h1>
<blockquote class="doxtable">
<p ><b>NOTICE</b> This project is <em>alpha</em> and as such, not all issues are resolved. While the synchronous mode is certainly functional, it is not useful for servers until async API is ready. The API is therefore subject to change! Please refer to the roadmap/github issues list.</p>
<p >Motivation: This is part of an as yet unreleased daemon. It is being used in an enterprise where thousands of records are generated and performence tracked. You can be sure that any bugs are fixed right away! </p>
</blockquote>
<table class="doxtable">
<tr>
<th align="left" colspan="2"><a class="el" href="classsiddiqsoft_1_1_cosmos_client.html" title="Cosmos Client Implements a stateful Cosmos Client using Cosmos SQL-API via REST.">siddiqsoft::CosmosClient</a>  </th></tr>
<tr>
<th>Function</th><th><p class="starttd">Description</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td><a class="el" href="classsiddiqsoft_1_1_cosmos_client.html#a0b1736e49ba7bfac52b822b1b3db7c7b" title="Re-configure the client. This will invoke the discoverRegions to populate the available regions and s...">siddiqsoft::CosmosClient::configure</a> </td><td><p class="starttd">Configure the client </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="classsiddiqsoft_1_1_cosmos_client.html#af069699d9c77079e1676fe3434787657" title="Gets the current configuration object.">siddiqsoft::CosmosClient::configuration</a> </td><td><p class="starttd">Returns the current configuration object </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><a class="el" href="classsiddiqsoft_1_1_cosmos_client.html#ac7b2ee16879b8038a93bc03558b48a60" title="List all databases for the given service Refer to https://docs.microsoft.com/en-us/rest/api/documentd...">siddiqsoft::CosmosClient::listDatabases</a> </td><td>Lists databases for the given Connection String  </td></tr>
<tr>
<td><a class="el" href="classsiddiqsoft_1_1_cosmos_client.html#ad19f8704a7616a2a070b0c1b2e54f465" title="List the collections for the given database.">siddiqsoft::CosmosClient::listCollections</a> </td><td>Lists collections for the given database  </td></tr>
<tr>
<td><a class="el" href="classsiddiqsoft_1_1_cosmos_client.html#a93a87a70d8b753bce97b377ba6e7f39a" title="List documents for the given database and collection.">siddiqsoft::CosmosClient::listDocuments</a> </td><td>Lists all documents within given collection  </td></tr>
<tr>
<td><a class="el" href="classsiddiqsoft_1_1_cosmos_client.html#ae6c4a58edb15bce7cac0a9fe607edafa" title="Discover the Regions for the current base Uri This method is invoked by the configuration method.">siddiqsoft::CosmosClient::discoverRegions</a> </td><td>Fetch the service settings for the given connection string  </td></tr>
<tr>
<td><a class="el" href="classsiddiqsoft_1_1_cosmos_client.html#a80b46c3db8b63be977aaa3aad53437d9" title="Create an entity in documentdb using the json object as the payload.">siddiqsoft::CosmosClient::create</a> </td><td>Synchronous. Create a json document in the collection  </td></tr>
<tr>
<td><a class="el" href="classsiddiqsoft_1_1_cosmos_client.html#ae4b0d10c595115bfaa6b9d3a768fcefb" title="Insert or Update existing document for the given id.">siddiqsoft::CosmosClient::upsert</a> </td><td>Synchronous. Create a json document in the collection  </td></tr>
<tr>
<td><a class="el" href="classsiddiqsoft_1_1_cosmos_client.html#a027164237de010648f0ac20c7fd5e366" title="Update existing document.">siddiqsoft::CosmosClient::update</a> </td><td>Synchronous. Create a json document in the collection  </td></tr>
<tr>
<td><a class="el" href="classsiddiqsoft_1_1_cosmos_client.html#a1ea5f734c81b29119ff20e0260948652" title="Find a given document by id.">siddiqsoft::CosmosClient::find</a> </td><td>Synchronous. Create a json document in the collection  </td></tr>
<tr>
<td><a class="el" href="classsiddiqsoft_1_1_cosmos_client.html#a2d6b4b5aa7f3f49c3248b828c7031139" title="Performs a query and continues an existing query if the continuation token exists CAUTION: If your qu...">siddiqsoft::CosmosClient::query</a> </td><td>Synchronous. Create a json document in the collection  </td></tr>
<tr>
<td><a class="el" href="classsiddiqsoft_1_1_cosmos_client.html#a9da24ecf8ea9b442d36a3319b0cd270a" title="Removes the document given the docId and pkId https://docs.microsoft.com/en-us/rest/api/documentdb/de...">siddiqsoft::CosmosClient::remove</a> </td><td>Synchronous. Remove json document given doc id from the collection  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md2"></a>
Getting Started</h1>
<ul>
<li>Get yourself Visual Studio 2019 v16.11 (we require C++20) with C++ workload</li>
<li>Clone this repository</li>
<li>Open the solution CosmosClient.sln</li>
<li>The environment variables must be set a the system-level (VS may need to be restarted)</li>
<li>Builds in x64 mode.</li>
</ul>
<p >You can start saving your documents in Cosmos with just 3 lines of code!</p><ol type="1">
<li>Declare the instance</li>
<li>Configure with json via <code>configure</code>.</li>
<li>Make call to <code>create</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md3"></a>
Configuration</h2>
<p >We use JSON object to configure the client.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Field   </th><th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>apiVersion</code>   </td><td class="markdownTableBodyNone">string   </td><td class="markdownTableBodyNone">Do not alter as this is "global". Fixed internally by the library <code>2018-12-31</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>connectionStrings</code>   </td><td class="markdownTableBodyNone">array of strings   </td><td class="markdownTableBodyNone">Each entry must be the Connection String entry for the Cosmos db obtained from the Azure Cosmos Portal.<br  />
WARNING: Only the first two elements are suppported.<br  />
0 - Primary Connection String<br  />
1 - Secondary Connection String    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>partitionKeyNames</code>   </td><td class="markdownTableBodyNone">array of strings   </td><td class="markdownTableBodyNone">Each entry is the element within your document corresponding to your configured partitionkey in the Azure Cosmos Portal.   </td></tr>
</table>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;apiVersion&quot;: &quot;2018-12-31&quot;,</div>
<div class="line">    &quot;connectionStrings&quot;: [],</div>
<div class="line">    &quot;partitionKeyNames&quot;: []</div>
<div class="line">}</div>
</div><!-- fragment --><blockquote class="doxtable">
<p >When you invoke <code>cosmosClient.configure( myConfig );</code> the contents of your <code>myConfig</code> json object are merged/replace the defaults. </p>
</blockquote>
<p>As a user, you need only provide: <code>connectionStrings</code> and the <code>partitionKeyName</code>.</p>
<p ><img src="Connection-Strings-Azure-Portal.png" alt="" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md4"></a>
Sample</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;nlohmann/json.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;siddiqsoft/azure-cosmos-restcl.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// See the example1 test for full source code</span></div>
<div class="line"><span class="comment">// Code here has been trimmed for brevity.</span></div>
<div class="line"><span class="keywordtype">void</span> example1(<span class="keyword">const</span> std::string&amp; p, <span class="keyword">const</span> std::string&amp; s)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// You should maintain one instance for each Cosmos service</span></div>
<div class="line">    <span class="comment">// It is advised to maintain a single instance per runtime (exe/dll/service)</span></div>
<div class="line">    <a class="code hl_class" href="classsiddiqsoft_1_1_cosmos_client.html">siddiqsoft::CosmosClient</a> cc;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// If you provide valid information, this will configure by probing Azure for</span></div>
<div class="line">    <span class="comment">// region information and sets up the read and write locations.</span></div>
<div class="line">    <span class="comment">// We use JSON object as the primary configuration interface.</span></div>
<div class="line">    <span class="comment">// The items you provide are muxed with the defaults so you can provide as much</span></div>
<div class="line">    <span class="comment">// or as little as the following elements.</span></div>
<div class="line">    cc.<a class="code hl_function" href="classsiddiqsoft_1_1_cosmos_client.html#a0b1736e49ba7bfac52b822b1b3db7c7b">configure</a>({{<span class="stringliteral">&quot;partitionKeyNames&quot;</span>, {<span class="stringliteral">&quot;__pk&quot;</span>}},</div>
<div class="line">                  {<span class="stringliteral">&quot;connectionStrings&quot;</span>, {p, s}}} );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// This is all we need to worry about when creating a document!</span></div>
<div class="line">    <span class="comment">// Cosmos requires the &quot;id&quot; field be in the document so we perform</span></div>
<div class="line">    <span class="comment">// no checks for id nor the primaryKey field.</span></div>
<div class="line">    <span class="comment">// The goal is to get you the response from Cosmos with little more</span></div>
<div class="line">    <span class="comment">// than convenience overhead.</span></div>
<div class="line">    <span class="comment">// No useless abstractions.</span></div>
<div class="line">    <span class="comment">// Just use the JSON object!</span></div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> [rc, doc] = cc.<a class="code hl_function" href="classsiddiqsoft_1_1_cosmos_client.html#a80b46c3db8b63be977aaa3aad53437d9">create</a>(dbName, collectionName,</div>
<div class="line">                                   {{<span class="stringliteral">&quot;id&quot;</span>, docId},  <span class="comment">// We send the JSON document</span></div>
<div class="line">                                    {<span class="stringliteral">&quot;ttl&quot;</span>, 360},   <span class="comment">// inline for this example</span></div>
<div class="line">                                    {<span class="stringliteral">&quot;__pk&quot;</span>, pkId}, <span class="comment">// PKID is required</span></div>
<div class="line">                                    {<span class="stringliteral">&quot;func&quot;</span>, __func__},</div>
<div class="line">                                    {<span class="stringliteral">&quot;source&quot;</span>, <span class="stringliteral">&quot;basic_tests.exe&quot;</span>}});</div>
<div class="line">        201 == rc)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// ...do something</span></div>
<div class="line">        <span class="comment">// ...useful with doc..</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Remove the just created document..</span></div>
<div class="line">        <span class="keyword">auto</span> [rcd, _] = cc.<a class="code hl_function" href="classsiddiqsoft_1_1_cosmos_client.html#a9da24ecf8ea9b442d36a3319b0cd270a">remove</a>(dbName, collectionName, doc.value(<span class="stringliteral">&quot;id&quot;</span>, docId), pkId);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclasssiddiqsoft_1_1_cosmos_client_html"><div class="ttname"><a href="classsiddiqsoft_1_1_cosmos_client.html">siddiqsoft::CosmosClient</a></div><div class="ttdoc">Cosmos Client Implements a stateful Cosmos Client using Cosmos SQL-API via REST.</div><div class="ttdef"><b>Definition:</b> azure-cosmos-restcl.hpp:404</div></div>
<div class="ttc" id="aclasssiddiqsoft_1_1_cosmos_client_html_a0b1736e49ba7bfac52b822b1b3db7c7b"><div class="ttname"><a href="classsiddiqsoft_1_1_cosmos_client.html#a0b1736e49ba7bfac52b822b1b3db7c7b">siddiqsoft::CosmosClient::configure</a></div><div class="ttdeci">CosmosClient &amp; configure(const nlohmann::json &amp;src={}) noexcept(false)</div><div class="ttdoc">Re-configure the client. This will invoke the discoverRegions to populate the available regions and s...</div><div class="ttdef"><b>Definition:</b> azure-cosmos-restcl.hpp:456</div></div>
<div class="ttc" id="aclasssiddiqsoft_1_1_cosmos_client_html_a80b46c3db8b63be977aaa3aad53437d9"><div class="ttname"><a href="classsiddiqsoft_1_1_cosmos_client.html#a80b46c3db8b63be977aaa3aad53437d9">siddiqsoft::CosmosClient::create</a></div><div class="ttdeci">CosmosResponseType create(const std::string &amp;dbName, const std::string &amp;collName, const nlohmann::json &amp;doc)</div><div class="ttdoc">Create an entity in documentdb using the json object as the payload.</div><div class="ttdef"><b>Definition:</b> azure-cosmos-restcl.hpp:625</div></div>
<div class="ttc" id="aclasssiddiqsoft_1_1_cosmos_client_html_a9da24ecf8ea9b442d36a3319b0cd270a"><div class="ttname"><a href="classsiddiqsoft_1_1_cosmos_client.html#a9da24ecf8ea9b442d36a3319b0cd270a">siddiqsoft::CosmosClient::remove</a></div><div class="ttdeci">uint32_t remove(const std::string &amp;dbName, const std::string &amp;collName, const std::string &amp;docId, const std::string &amp;pkId)</div><div class="ttdoc">Removes the document given the docId and pkId https://docs.microsoft.com/en-us/rest/api/documentdb/de...</div><div class="ttdef"><b>Definition:</b> azure-cosmos-restcl.hpp:734</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Testing Notes</h2>
<dl class="section see"><dt>See also</dt><dd>The files <code>CosmosClient.cpp</code>, <code>CosmosConnection.cpp</code> and <code>CosmosEndpoint.cpp</code> contain the googletest files.</dd></dl>
<p>Testing requires that we declare the following environment variables (either from your local terminal or during the CI step.)</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Environment Variable   </th><th class="markdownTableHeadLeft">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CCTEST_PRIMARY_CS</code>   </td><td class="markdownTableBodyLeft">The Primary Account Connection String from the Azure Portal for Cosmos.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CCTEST_SECONDARY_CS</code>   </td><td class="markdownTableBodyLeft">The Secondary Account Connection String from the Azure Portal for Cosmos.   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
